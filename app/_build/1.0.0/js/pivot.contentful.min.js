const contentful_auth="Basic YOUR_BASICAUTH_HERE";app.service("contentfulService",function($q,$http,$filter){var srv=this;srv.uri="https://cdn.contentful.com/spaces/YOUR_SPACEID_HERE/",srv.header={headers:{"Content-Type":"application/json",Authorization:"Bearer YOUR_BEARER_HERE"}},this.GetEntries=function(){var deferred=$q.defer();return $http.get(srv.uri+"entries/",srv.header).then(function(response){srv.entries=response.data.items;var articles=$filter("filter")(response.data.items,{sys:{contentType:{sys:{id:"article"}}}}),accordions=$filter("filter")(response.data.items,{sys:{contentType:{sys:{id:"accordian"}}}}),menus=$filter("filter")(response.data.items,{sys:{contentType:{sys:{id:"menu"}}}}),galleries=$filter("filter")(response.data.items,{sys:{contentType:{sys:{id:"gallery"}}}}),blocks=$filter("filter")(response.data.items,{sys:{contentType:{sys:{id:"block"}}}});deferred.resolve({articles:articles.map(obj=>srv.MapArticle(obj,obj.sys.id)),accordions:accordions.map(obj=>srv.MapAccordion(obj,obj.sys.id)),menus:menus.map(obj=>srv.MapMenu(obj,obj.sys.id)),galleries:galleries.map(obj=>srv.MapGallery(obj,obj.sys.id)),blocks:blocks.map(obj=>srv.MapBlock(obj,obj.sys.id))})}),deferred.promise},this.GetAssets=function(){var deferred=$q.defer();return $http.get(srv.uri+"assets/",srv.header).then(function(response){srv.assets=response.data.items.map(obj=>srv.MapAsset(obj,obj.sys.id)),deferred.resolve(srv.assets)}),deferred.promise},this.parseRichText=function(obj){for(var deferred=$q.defer(),contentArray=[],i=0;i<obj.content.length;i++)switch(obj.content[i].nodeType){case"embedded-asset-block":contentArray.push(void 0),srv.GetRichTextAsset(obj.content[i].data.target.sys.id,i).then(function(asset){-1!==asset.index&&(contentArray[asset.index]={component:"image",data:asset.data})});break;case"embedded-entry-block":contentArray.push(void 0),srv.GetRichTextEntry(obj.content[i].data.target.sys.id,i).then(function(entry){-1!==entry.index&&(contentArray[entry.index]={component:entry.component,data:entry.data})});break;default:contentArray.push({component:"html",data:srv.parseRichTextNode(obj.content[i])})}for(var output="",i=0;i<contentArray.length;i++)output+=contentArray[i];return deferred.resolve(contentArray),deferred.promise},this.GetRichTextAsset=function(id,index){var deferred=$q.defer(),obj=$filter("filter")(srv.assets,{id:id})[0];return deferred.resolve({index:index,data:obj}),deferred.promise},this.GetRichTextEntry=function(id,index){var deferred=$q.defer(),obj=$filter("filter")(srv.entries,{sys:{id:id}})[0];switch(obj.sys.contentType.sys.id){case"accordian":srv.parseRichText(obj.fields.text).then(function(text){obj.fields.text=text,deferred.resolve({index:index,component:"accordion",data:srv.MapAccordion(obj)})});break;case"gallery":srv.parseRichText(obj.fields.assets).then(function(assets){obj.fields.assets=assets,deferred.resolve({index:index,component:"gallery",data:srv.MapGallery(obj)})});break;case"note":deferred.resolve({index:index,component:"note",data:srv.MapNote(obj)})}return deferred.promise},this.parseRichTextNode=function(obj){var output="";if("text"!=obj.nodeType)for(var i=0;i<obj.content.length;i++){var tag="";switch(obj.nodeType){case"blockquote":tag="blockquote";break;case"paragraph":tag="p";break;case"unordered-list":tag="ul";break;case"list-item":tag="li";break;case"hyperlink":tag="a";break;case"heading-1":tag="h1";break;case"heading-2":tag="h2";break;case"heading-3":tag="h3";break;case"heading-4":tag="h4";break;case"heading-5":tag="h5";break;case"heading-6":tag="h6"}tag&&0==i&&(output+="<"+tag+("a"==tag?' href="'+obj.data.uri+'"':"")+">"),output+=srv.parseRichTextNode(obj.content[i]),tag&&i==obj.content.length-1&&(output+="</"+tag+">")}else if(obj.marks)if(obj.marks.length)for(var i=0;i<obj.marks.length;i++){var tag="";switch(obj.marks[i].type){case"bold":tag="b";break;case"italic":tag="i";break;case"underline":tag="u"}tag&&0==i&&(output+="<"+tag+">"),output+=obj.value,tag&&i==obj.marks.length-1&&(output+="</"+tag+">")}else output+=obj.value;else output+=obj.value;return output},this.MapArticle=function(obj,id){var menu_id=obj.fields.menuId?obj.fields.menuId:void 0,aside_image_id=obj.fields.asideImage?obj.fields.asideImage.sys.id:void 0,body_image_id=obj.fields.bodyImage?obj.fields.bodyImage.sys.id:void 0;return{id:id,name:obj.fields.name,label:obj.fields.label,title:obj.fields.title,business_unit:obj.fields.businessUnit,blocks:obj.fields.blocks,notes:obj.fields.notes,content:obj.fields.content,enhanced:"Landing"==obj.fields.template,aside_image_id:aside_image_id,body_image_id:body_image_id,menu_id:menu_id}},this.MapMenu=function(obj,id){return{id:id,name:obj.fields.name,label:obj.fields.label,description:obj.fields.description,data:obj.fields.data,image:obj.fields.image,type:obj.fields.type}},this.MapBlock=function(obj,id){return{id:id,name:obj.fields.name,label:obj.fields.label,icon:obj.fields.labelIcon,detail:obj.fields.detail,style:obj.fields.style}},this.MapAsset=function(obj,id){return{id:id,url:obj.fields.file.url,type:obj.fields.file.contentType,size:obj.fields.file.details.size,image:obj.fields.file.details.image,description:obj.fields.description}},this.MapAccordion=function(obj,id){var content=obj.fields.text?obj.fields.text:obj.fields.content;return{id:id,label:obj.fields.label,title:obj.fields.title,content:content}},this.MapGallery=function(obj,id){return{id:id,name:obj.fields.name,title:obj.fields.title,images:obj.fields.assets}},this.MapNote=function(obj,id){return{id:id,label:obj.fields.label,detail:obj.fields.detail}}});var article_html="";article_html+="<div data-ng-if=articleCtrl.object>",article_html+="<h1 data-ng-if=articleCtrl.object.fields.label>{{articleCtrl.object.fields.label}}</h1>",article_html+='<div data-ng-if=articleCtrl.object.fields.image><img data-ng-src="http:{{articleCtrl.object.fields.image}}" /></div>',article_html+='<div markdown data-ng-bind-html="articleCtrl.object.fields.bodyText | markdown">{{articleCtrl.object.fields.bodyText}}</div>';var article_css="";function ArticleComponentCtrl($q,$http,$window,$interval){var articleCtrl=this;articleCtrl.uri="http://127.0.0.1:8050/",articleCtrl.header={headers:{"Content-Type":"application/json",Authorization:contentful_auth}},articleCtrl.$onInit=function(){articleCtrl.GetEntry().then(function(response){articleCtrl.object=response})},articleCtrl.GetEntry=function(){var deferred=$q.defer();return $http.get(articleCtrl.uri+"entry/"+articleCtrl.sid+"/"+articleCtrl.aid+"/",articleCtrl.header).then(function(response){if("NotFound"==response.data.id)return deferred.resolve({error:"ID provided is not valid."}),deferred.promise;var obj=response.data;null!=obj.fields.bodyImage&&$http.get(articleCtrl.uri+"asset/"+articleCtrl.sid+"/"+obj.fields.bodyImage.sys.id,articleCtrl.header).then(function(file){obj.fields.image=file.data.fields.file.url}),deferred.resolve(obj)}),deferred.promise},articleCtrl.Callback=function(){articleCtrl.callbackFn&&articleCtrl.callbackFn({obj:articleCtrl.object})}}article_css+='<style type="text/css">',article_css+="article-component { display: block; position: relative; padding: 1em; background-color: WHITESMOKE; }";const articleComponent={controller:ArticleComponentCtrl,controllerAs:"articleCtrl",bindings:{callbackFn:"&?",sid:"<",aid:"<"},template:(article_css+="</style>")+(article_html+="</div>")};angular.module("app").component("articleComponent",articleComponent);var banner_html="";banner_html+='<div data-ng-if=bannerCtrl.objects style="background-image: url(\'{{bannerCtrl.object.file}}\')" data-ng-animate-swap=bannerCtrl.index class="swap-animation" data-ng-class=bannerCtrl.SetObject()>',banner_html+="<ul>",banner_html+="<li data-ng-click=bannerCtrl.Callback()>",banner_html+="<label data-ng-if=bannerCtrl.object.label>{{bannerCtrl.object.label}}</label>",banner_html+="<label data-ng-if=bannerCtrl.object.description>{{bannerCtrl.object.description}}</label>",banner_html+="</li>",banner_html+="<li data-ng-if=bannerCtrl.multiple>",banner_html+='<button data-ng-click=bannerCtrl.SetIndex($index) data-ng-repeat="each in [].constructor(bannerCtrl.objects.length) track by $index" data-ng-class="{\'active\': $index == bannerCtrl.index}"></button>',banner_html+="</li>",banner_html+="</ul>";var banner_css="";function BannerComponentCtrl($q,$http,$window,$interval){var bannerCtrl=this;bannerCtrl.uri="http://127.0.0.1:8050/",bannerCtrl.header={headers:{"Content-Type":"application/json",Authorization:contentful_auth}},bannerCtrl.$onInit=function(){bannerCtrl.GetEntries().then(function(response){console.log(response),bannerCtrl.objects=response,console.log(bannerCtrl.objects.length),bannerCtrl.index||bannerCtrl.SetIndex(0),bannerCtrl.interval||(bannerCtrl.interval=!1),bannerCtrl.multiple=bannerCtrl.objects.length>1,bannerCtrl.SetObject(),$interval(function(){bannerCtrl.multiple&&bannerCtrl.interval&&bannerCtrl.index++},bannerCtrl.interval)})},bannerCtrl.SetIndex=function(int){bannerCtrl.index=int},bannerCtrl.SetObject=function(){bannerCtrl.index>=bannerCtrl.objects.length&&bannerCtrl.SetIndex(0),bannerCtrl.objects[bannerCtrl.index]&&(bannerCtrl.object=bannerCtrl.objects[bannerCtrl.index].fields)},bannerCtrl.GetEntries=function(){var objs=[],deferred=$q.defer(),count=0;return $http.get(bannerCtrl.uri+"entries/"+bannerCtrl.sid+"/banner/",bannerCtrl.header).then(function(response){for(var resp=response.data,i=0;i<resp.length;i++)bannerCtrl.GetEntry(resp[i].id).then(function(obj){objs.push(obj),++count==resp.length&&deferred.resolve(objs)})}),deferred.promise},bannerCtrl.GetEntry=function(id){var deferred=$q.defer();return $http.get(bannerCtrl.uri+"entry/"+bannerCtrl.sid+"/"+id+"/",bannerCtrl.header).then(function(response){var obj=response.data;null!=obj.fields.image&&$http.get(bannerCtrl.uri+"asset/"+bannerCtrl.sid+"/"+obj.fields.image.sys.id,bannerCtrl.header).then(function(file){obj.fields.file=file.data.fields.file.url}),deferred.resolve(obj)}),deferred.promise},bannerCtrl.Callback=function(){bannerCtrl.callbackFn&&bannerCtrl.callbackFn({obj:bannerCtrl.object})}}banner_css+='<style type="text/css">',banner_css+="banner-component * { margin: 0; padding: 0; }",banner_css+="banner-component { display: block; position: relative; width: 100%; height: 50%; }",banner_css+="banner-component > div { display: flex; align-items: flex-end; width: 100%; height: 25em; }",banner_css+="banner-component > div > ul { display: table; width: 100%; margin: 1em; padding: 1em; background-color: RGB(255,255,255); }",banner_css+="banner-component > div > ul > li { display: table-cell; vertical-align: bottom; }",banner_css+="banner-component > div > ul > li:first-child { width: 100%; }",banner_css+="banner-component > div > ul > li:first-child > label { display: block; }",banner_css+="banner-component > div > ul > li:first-child > label:first-child { font-size: 2em; }",banner_css+="banner-component > div > ul > li:last-child { whitespace: no-wrap; }",banner_css+="banner-component > div > ul > li:last-child > button { border: none; background-color:RGB(200,200,200); width: 1em; height: 1em; margin-right: .5em; }",banner_css+="banner-component > div > ul > li:last-child > button.active, banner-component > div > ul > li:last-child > button:hover { background-color: RGB(0,0,0); }",banner_css+="banner-component .swap-animation.ng-enter, .swap-animation.ng-leave { transition:2s linear all; }",banner_css+="banner-component .swap-animation.ng-enter { opacity: 0; }",banner_css+="banner-component .swap-animation.ng-leave { opacity: 1; }";const bannerComponent={controller:BannerComponentCtrl,controllerAs:"bannerCtrl",bindings:{callbackFn:"&?",objects:"<",index:"<?",interval:"<?",sid:"<"},template:(banner_css+="</style>")+(banner_html+="</div>")};angular.module("app").component("bannerComponent",bannerComponent);var searcharticle_html="";searcharticle_html+="<fieldset>",searcharticle_html+="<legend data-ng-if=searcharticleCtrl.label>{{searcharticleCtrl.label}}</legend>",searcharticle_html+="<ul>",searcharticle_html+="<li>",searcharticle_html+='<input autofocus type=text placeholder="Keyword" data-ng-model=searcharticleCtrl.query data-ng-change=searcharticleCtrl.Callback() data-ng-model-options="{debounce: 1000}">',searcharticle_html+="</li>",searcharticle_html+="</ul>";var searcharticle_css="";function SearchArticleComponentCtrl($http,$filter){var searcharticleCtrl=this;searcharticleCtrl.uri="http://127.0.0.1:8050/",searcharticleCtrl.header={headers:{"Content-Type":"application/json",Authorization:contentful_auth}},searcharticleCtrl.$onInit=function(){searcharticleCtrl.query=void 0},searcharticleCtrl.Callback=function(){searcharticleCtrl.query.length>2&&$http.get(searcharticleCtrl.uri+"entries/"+searcharticleCtrl.sid+"/article/",searcharticleCtrl.header).then(function(response){var resp=response.data;resp=$filter("filter")(resp,searcharticleCtrl.query),searcharticleCtrl.callbackFn({obj:resp})})}}searcharticle_css+="<style>",searcharticle_css+="searcharticle-component * { margin:0; padding:0; }",searcharticle_css+="searcharticle-component { display: block; position: relative; }",searcharticle_css+="searcharticle-component > ul { display: table; width: 100%; padding: 1em 0; border-bottom-style: solid; border-bottom-width: 1px; }",searcharticle_css+="searcharticle-component > ul > li { display: table-cell; }";const searcharticleComponent={controller:SearchArticleComponentCtrl,controllerAs:"searcharticleCtrl",bindings:{callbackFn:"&",label:"<?",sid:"<"},template:(searcharticle_css+="</style>")+(searcharticle_html+="</fieldset>")};angular.module("app").component("searcharticleComponent",searcharticleComponent);